$.fn.touchMenu=function(e){var n={},o={inmenu:!0,open:!1,clickTime:0},s=$(this),i=$.extend({fadeAway:1e3,fadeAwayStart:200,startClick:50,openMenu:600,fullscreen:!1},e);s.addClass("touchMenu"),n.closeMenu=function(e){o.inmenu=!1,s.hasClass("open")&&(e?(s.removeClass("closing open"),o.open=!1):setTimeout(function(){s.removeClass("noclose").addClass("closing"),i.remover=setTimeout(function(){s.removeClass("closing open"),o.open=!1},i.fadeAway-i.fadeAwayStart)},i.fadeAwayStart))},n.stopCloseMenu=function(){o.inmenu=!0,s.hasClass("closing")&&(clearTimeout(i.remover),s.removeClass("closing").addClass("noclose"))},n.startMenu=function(){s.addClass("clicking"),o.openMenu=setTimeout(function(){s.removeClass("clicking").addClass("open"),o.open=!0},i.openMenu)},n.moveMenu=function(e){s.hasClass("open")||s.css({left:e.pageX,top:e.pageY})},n.stopMenu=function(){s.removeClass("clicking"),clearTimeout(i.initClick),clearTimeout(o.openMenu),clearInterval(i.interval)},s.on("mouseenter",function(){n.stopCloseMenu()}),s.on("mouseleave",function(){n.closeMenu()}),$(window).on("mousedown",function(e){o.clickTime=0,i.interval=setInterval(function(){o.clickTime++,o.clickTime>i.startClick&&n.startMenu(e)},1)}),$(window).on("mousemove",function(e){n.moveMenu(e)}),$(window).on("mouseup",function(e){n.stopMenu(e)}),$(window).on("click",function(){o.open&&!o.inmenu&&n.closeMenu(!0)})};